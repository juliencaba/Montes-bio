<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montes Bio - Protocoles Intelligents</title>
    <meta name="description" content="Plateforme IA pour cr√©er des protocoles de production de biomol√©cules pharmaceutiques">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß¨</text></svg>">

```
<!-- Biblioth√®que jsPDF pour g√©n√©ration PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Biblioth√®que PDF.js pour lecture PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #2d3748 100%);
        color: #e2e8f0;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .header {
        background: rgba(15, 20, 25, 0.9);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        border-bottom: 1px solid rgba(74, 222, 128, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: #4ade80;
        text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    .nav-links {
        display: flex;
        gap: 2rem;
        list-style: none;
    }

    .nav-links a {
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.3s ease;
        padding: 0.5rem 1rem;
        border-radius: 8px;
    }

    .nav-links a:hover {
        color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
        transform: translateY(-2px);
    }

    /* NOUVEAU: S√©lecteur de langue simple */
    .language-selector {
        display: flex;
        background: rgba(30, 41, 59, 0.6);
        border-radius: 8px;
        padding: 0.25rem;
        border: 1px solid rgba(74, 222, 128, 0.2);
    }

    .lang-btn {
        background: none;
        border: none;
        color: #94a3b8;
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .lang-btn.active {
        background: linear-gradient(135deg, #4ade80, #3b82f6);
        color: white;
    }

    .lang-btn:hover:not(.active) {
        color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
    }

    .main-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .hero-section {
        text-align: center;
        padding: 3rem 0;
        background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
        border-radius: 20px;
        margin-bottom: 3rem;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(74,222,128,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .hero-title {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #4ade80, #3b82f6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero-subtitle {
        font-size: 1.2rem;
        color: #94a3b8;
        margin-bottom: 2rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }

    .feature-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(74, 222, 128, 0.2);
        border-radius: 16px;
        padding: 2rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #4ade80, #3b82f6);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-5px);
        border-color: rgba(74, 222, 128, 0.4);
        box-shadow: 0 20px 40px rgba(74, 222, 128, 0.1);
    }

    .feature-card:hover::before {
        transform: scaleX(1);
    }

    .feature-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #4ade80, #3b82f6);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        font-size: 1.5rem;
    }

    .feature-title {
        font-size: 1.3rem;
        font-weight: bold;
        color: #f1f5f9;
        margin-bottom: 1rem;
    }

    .feature-description {
        color: #94a3b8;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .action-btn {
        background: linear-gradient(135deg, #4ade80, #3b82f6);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(74, 222, 128, 0.3);
    }

    .workspace-section {
        background: rgba(30, 41, 59, 0.4);
        border-radius: 20px;
        padding: 2rem;
        margin: 3rem 0;
        border: 1px solid rgba(74, 222, 128, 0.2);
    }

    .workspace-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .workspace-title {
        font-size: 1.8rem;
        font-weight: bold;
        color: #f1f5f9;
    }

    .document-choice {
        background: rgba(15, 20, 25, 0.8);
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        border: 2px solid rgba(74, 222, 128, 0.3);
        text-align: center;
    }

    .choice-buttons {
        display: flex;
        gap: 2rem;
        justify-content: center;
        flex-wrap: wrap;
        margin: 2rem 0;
    }

    .choice-btn {
        background: rgba(74, 222, 128, 0.1);
        color: #4ade80;
        border: 2px solid rgba(74, 222, 128, 0.3);
        padding: 1.5rem 2rem;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 200px;
        text-align: center;
    }

    .choice-btn:hover, .choice-btn.selected {
        background: rgba(74, 222, 128, 0.2);
        border-color: #4ade80;
        transform: scale(1.05);
    }

    .upload-zone {
        border: 2px dashed rgba(74, 222, 128, 0.3);
        border-radius: 12px;
        padding: 3rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        margin: 1rem 0;
        display: none;
    }

    .upload-zone:hover {
        border-color: rgba(74, 222, 128, 0.6);
        background: rgba(74, 222, 128, 0.05);
    }

    .upload-icon {
        font-size: 3rem;
        color: #4ade80;
        margin-bottom: 1rem;
    }

    .molecule-selection {
        display: none;
        margin: 2rem 0;
    }

    .molecule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .molecule-card {
        background: rgba(45, 55, 72, 0.7);
        border: 1px solid rgba(74, 222, 128, 0.2);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }

    .molecule-card:hover, .molecule-card.selected {
        border-color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
        transform: translateY(-2px);
    }

    .protocol-generator {
        background: rgba(45, 55, 72, 0.6);
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        display: none;
    }

    .input-group {
        margin-bottom: 1.5rem;
    }

    .input-label {
        display: block;
        color: #cbd5e1;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .input-field {
        width: 100%;
        background: rgba(15, 20, 25, 0.8);
        border: 1px solid rgba(74, 222, 128, 0.3);
        border-radius: 8px;
        padding: 1rem;
        color: #e2e8f0;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .input-field:focus {
        outline: none;
        border-color: #4ade80;
        box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
    }

    .textarea-field {
        min-height: 120px;
        resize: vertical;
    }

    .generated-protocol {
        background: rgba(15, 20, 25, 0.8);
        border-left: 4px solid #4ade80;
        padding: 1.5rem;
        border-radius: 8px;
        margin-top: 1rem;
        font-family: 'Courier New', monospace;
        line-height: 1.6;
        display: none;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }

    .stat-card {
        background: rgba(45, 55, 72, 0.6);
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(74, 222, 128, 0.2);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #4ade80;
    }

    .stat-label {
        color: #94a3b8;
        margin-top: 0.5rem;
    }

    .floating-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }

    .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #4ade80;
        border-radius: 50%;
        animation: float 6s infinite ease-in-out;
        opacity: 0.6;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
        50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
    }

    .recent-protocols {
        background: rgba(30, 41, 59, 0.4);
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
    }

    /* NOUVEAU: Styles pour le questionnaire */
    .project-questionnaire {
        background: rgba(15, 20, 25, 0.8);
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        border: 2px solid rgba(139, 92, 246, 0.3);
    }

    .questionnaire-step {
        margin-bottom: 2rem;
    }

    .question-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
    }

    .question-option {
        background: rgba(30, 41, 59, 0.6);
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        color: #e2e8f0;
        font-weight: 500;
    }

    .question-option:hover {
        border-color: #8b5cf6;
        background: rgba(139, 92, 246, 0.1);
        transform: translateY(-2px);
    }

    .question-option.selected {
        border-color: #4ade80;
        background: rgba(74, 222, 128, 0.15);
        color: #4ade80;
    }

    .question-option.multi-select.selected {
        border-color: #3b82f6;
        background: rgba(59, 130, 246, 0.15);
        color: #3b82f6;
    }

    .protocol-item {
        background: rgba(45, 55, 72, 0.6);
        border: 1px solid rgba(74, 222, 128, 0.2);
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
        transition: all 0.3s ease;
    }

    .protocol-item:hover {
        border-color: rgba(74, 222, 128, 0.4);
        transform: translateX(5px);
    }

    .protocol-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .protocol-name {
        font-weight: bold;
        color: #f1f5f9;
    }

    .protocol-date {
        color: #94a3b8;
        font-size: 0.9rem;
    }

    @media (max-width: 768px) {
        .nav {
            flex-direction: column;
            gap: 1rem;
        }

        .nav-right {
            flex-direction: column;
            gap: 1rem;
        }

        .nav-links {
            gap: 1rem;
        }

        .hero-title {
            font-size: 2rem;
        }

        .features-grid {
            grid-template-columns: 1fr;
        }

        .choice-buttons {
            flex-direction: column;
            align-items: center;
        }

        .molecule-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
```

</head>
<body>
    <div class="floating-particles" id="particles"></div>

```
<header class="header">
    <nav class="nav">
        <div class="logo">Montes Bio</div>
        <div class="nav-right">
            <ul class="nav-links">
                <li><a href="#accueil" data-text="nav-home">Accueil</a></li>
                <li><a href="#protocoles" data-text="nav-protocols">Protocoles</a></li>
                <li><a href="#recherche" data-text="nav-research">Recherche</a></li>
                <li><a href="#formation" data-text="nav-training">Formation</a></li>
                <li><a href="#contact" data-text="nav-contact">Contact</a></li>
            </ul>
            <!-- NOUVEAU: S√©lecteur de langue -->
            <div class="language-selector">
                <button class="lang-btn active" onclick="switchLanguage('fr')">FR</button>
                <button class="lang-btn" onclick="switchLanguage('en')">EN</button>
            </div>
        </div>
    </nav>
</header>

<div class="main-container">
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title" data-text="hero-title">Protocoles Biotechnologiques</h1>
            <p class="hero-subtitle" data-text="hero-subtitle">
                Cr√©ez des protocoles de production et purification de biomol√©cules pharmaceutiques 
                gr√¢ce √† l'IA. Prot√©ines, anticorps, vecteurs viraux - optimis√©s pour votre recherche.
            </p>
            <button class="action-btn" onclick="scrollToWorkspace()" data-text="start-now">Commencer Maintenant</button>
        </div>
    </section>

    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">üìä</div>
            <h3 class="feature-title" data-text="feature1-title">Analyse d'Articles Scientifiques</h3>
            <p class="feature-description" data-text="feature1-desc">
                Notre IA analyse automatiquement les derni√®res publications pour extraire les protocoles 
                upstream/downstream et m√©thodologies pertinentes √† votre biomol√©cule.
            </p>
            <button class="action-btn" data-text="explore">Explorer</button>
        </div>

        <div class="feature-card">
            <div class="feature-icon">üß¨</div>
            <h3 class="feature-title" data-text="feature2-title">Production de Biomol√©cules</h3>
            <p class="feature-description" data-text="feature2-desc">
                Protocoles sp√©cialis√©s pour prot√©ines recombinantes, anticorps, vecteurs viraux, 
                VLP et LNP. De E.coli aux cellules mammaliennes.
            </p>
            <button class="action-btn" data-text="generate">G√©n√©rer</button>
        </div>

        <div class="feature-card">
            <div class="feature-icon">‚öóÔ∏è</div>
            <h3 class="feature-title" data-text="feature3-title">Upstream & Downstream</h3>
            <p class="feature-description" data-text="feature3-desc">
                Workflow complet de la fermentation √† la formulation finale. 
                Chromatographie, filtration, concentration - protocoles d√©taill√©s.
            </p>
            <button class="action-btn" data-text="browse">Parcourir</button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">2,847</div>
            <div class="stat-label" data-text="stat1">Articles Biotech Analys√©s</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">156</div>
            <div class="stat-label" data-text="stat2">Protocoles G√©n√©r√©s</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">43</div>
            <div class="stat-label" data-text="stat3">Pharma Partenaires</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">98</div>
            <div class="stat-label" data-text="stat4">% Satisfaction</div>
        </div>
    </div>

    <section class="workspace-section" id="workspace">
        <div class="workspace-header">
            <h2 class="workspace-title" data-text="workspace-title">Espace de Cr√©ation</h2>
            <button class="action-btn" data-text="new-project">Nouveau Projet</button>
        </div>

        <!-- Choix initial -->
        <div class="document-choice" id="documentChoice">
            <h3 style="color: #f1f5f9; margin-bottom: 2rem;" data-text="doc-choice-title">üìö Documents de R√©f√©rence</h3>
            <p style="color: #94a3b8; margin-bottom: 2rem;" data-text="doc-choice-desc">
                Avez-vous des documents √† analyser ou souhaitez-vous une recherche automatique ?
            </p>
            <div class="choice-buttons">
                <button class="choice-btn" onclick="selectDocumentOption('upload')">
                    <span data-text="choice-upload">üìÑ J'ai des Documents</span><br>
                    <small style="opacity: 0.7;" data-text="choice-upload-sub">Articles, protocoles existants</small>
                </button>
                <button class="choice-btn" onclick="selectDocumentOption('search')">
                    <span data-text="choice-search">üîç Recherche Automatique</span><br>
                    <small style="opacity: 0.7;" data-text="choice-search-sub">L'IA trouve les r√©f√©rences</small>
                </button>
            </div>
        </div>

        <div class="upload-zone" id="uploadZone">
            <input type="file" id="fileInput" multiple accept=".pdf" style="display: none;" onchange="handleRealFileUpload(event)">
            <div class="upload-icon">üìÅ</div>
            <h3 data-text="upload-title">Cliquez pour s√©lectionner vos fichiers PDF</h3>
            <p data-text="upload-subtitle">ou glissez-d√©posez ici</p>
            <small style="color: #94a3b8;" data-text="upload-formats">Formats support√©s: PDF ‚Ä¢ Taille max: 10MB par fichier</small>
        </div>

        <!-- Zone d'affichage des fichiers upload√©s -->
        <div id="uploadedFilesList" style="display: none; margin: 1rem 0;">
            <h4 style="color: #4ade80; margin-bottom: 1rem;" data-text="files-analyzed">üìÑ Fichiers Analys√©s:</h4>
            <div id="filesList"></div>
        </div>

        <!-- Zone de progression d'analyse -->
        <div id="analysisProgress" style="display: none; background: rgba(30, 41, 59, 0.4); border-radius: 12px; padding: 1.5rem; margin: 1rem 0;">
            <h4 style="color: #4ade80; margin-bottom: 1rem;" data-text="analysis-progress">ü§ñ Analyse en cours...</h4>
            <div style="background: rgba(74, 222, 128, 0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="progressBar" style="background: linear-gradient(90deg, #4ade80, #3b82f6); height: 100%; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="progressText" style="color: #94a3b8; margin-top: 0.5rem;" data-text="analysis-init">Initialisation...</p>
        </div>

        <!-- NOUVEAU: Questionnaire Projet -->
        <div class="project-questionnaire" id="projectQuestionnaire" style="display: none; background: rgba(15, 20, 25, 0.8); border-radius: 16px; padding: 2rem; margin: 2rem 0; border: 2px solid rgba(139, 92, 246, 0.3);">
            <h3 style="color: #a78bfa; margin-bottom: 2rem; text-align: center;" data-text="questionnaire-title">üéØ Questionnaire Projet</h3>
            <p style="color: #94a3b8; text-align: center; margin-bottom: 2rem;" data-text="questionnaire-desc">
                Quelques questions pour personnaliser votre protocole et optimiser les recommandations
            </p>
            
            <div id="questionnaireSteps">
                <!-- √âtape 1: Type de projet -->
                <div class="questionnaire-step" id="step1" style="display: block;">
                    <h4 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="step1-title">1. Quel est le type de votre projet ?</h4>
                    <div class="question-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="question-option" onclick="selectProjectType('research')" data-value="research">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üî¨</div>
                            <span data-text="project-research">Recherche Acad√©mique</span>
                            <small style="display: block; opacity: 0.7;" data-text="project-research-desc">Publications, √©tudes fondamentales</small>
                        </button>
                        <button class="question-option" onclick="selectProjectType('preclinical')" data-value="preclinical">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üß™</div>
                            <span data-text="project-preclinical">D√©veloppement Pr√©clinique</span>
                            <small style="display: block; opacity: 0.7;" data-text="project-preclinical-desc">Tests in vitro/in vivo</small>
                        </button>
                        <button class="question-option" onclick="selectProjectType('clinical')" data-value="clinical">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üè•</div>
                            <span data-text="project-clinical">D√©veloppement Clinique</span>
                            <small style="display: block; opacity: 0.7;" data-text="project-clinical-desc">Phases I/II/III</small>
                        </button>
                        <button class="question-option" onclick="selectProjectType('commercial')" data-value="commercial">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üè≠</div>
                            <span data-text="project-commercial">Production Commerciale</span>
                            <small style="display: block; opacity: 0.7;" data-text="project-commercial-desc">Manufacturing, distribution</small>
                        </button>
                    </div>
                </div>

                <!-- √âtape 2: Concentration cible -->
                <div class="questionnaire-step" id="step2" style="display: none;">
                    <h4 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="step2-title">2. Quelle concentration cible visez-vous ?</h4>
                    <div class="question-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                        <button class="question-option" onclick="selectConcentration('low')" data-value="low">
                            <span data-text="concentration-low">Recherche</span>
                            <small style="display: block; opacity: 0.7;" data-text="concentration-low-desc">0.1-10 mg/mL | 10^8-10^11 vp/mL</small>
                        </button>
                        <button class="question-option" onclick="selectConcentration('medium')" data-value="medium">
                            <span data-text="concentration-medium">Production Pilote</span>
                            <small style="display: block; opacity: 0.7;" data-text="concentration-medium-desc">1-50 mg/mL | 10^11-10^12 vp/mL</small>
                        </button>
                        <button class="question-option" onclick="selectConcentration('high')" data-value="high">
                            <span data-text="concentration-high">Production Th√©rapeutique</span>
                            <small style="display: block; opacity: 0.7;" data-text="concentration-high-desc">10-150 mg/mL | 10^12-10^13 vp/mL</small>
                        </button>
                        <button class="question-option" onclick="selectConcentration('industrial')" data-value="industrial">
                            <span data-text="concentration-industrial">Production Industrielle</span>
                            <small style="display: block; opacity: 0.7;" data-text="concentration-industrial-desc">> 100 mg/mL | > 10^13 vp/mL</small>
                        </button>
                    </div>
                </div>

                <!-- √âtape 3: D√©lai -->
                <div class="questionnaire-step" id="step3" style="display: none;">
                    <h4 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="step3-title">3. Dans quel d√©lai souhaitez-vous obtenir votre produit ?</h4>
                    <div class="question-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <button class="question-option" onclick="selectTimeline('urgent')" data-value="urgent">
                            <span data-text="timeline-urgent">< 2 semaines</span>
                            <small style="display: block; opacity: 0.7;" data-text="timeline-urgent-desc">Urgent</small>
                        </button>
                        <button class="question-option" onclick="selectTimeline('normal')" data-value="normal">
                            <span data-text="timeline-normal">2-8 semaines</span>
                            <small style="display: block; opacity: 0.7;" data-text="timeline-normal-desc">Standard</small>
                        </button>
                        <button class="question-option" onclick="selectTimeline('flexible')" data-value="flexible">
                            <span data-text="timeline-flexible">2-6 mois</span>
                            <small style="display: block; opacity: 0.7;" data-text="timeline-flexible-desc">Flexible</small>
                        </button>
                        <button class="question-option" onclick="selectTimeline('long')" data-value="long">
                            <span data-text="timeline-long">> 6 mois</span>
                            <small style="display: block; opacity: 0.7;" data-text="timeline-long-desc">Long terme</small>
                        </button>
                    </div>
                </div>

                <!-- √âtape 4: Budget -->
                <div class="questionnaire-step" id="step4" style="display: none;">
                    <h4 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="step4-title">4. Quel est votre budget approximatif ?</h4>
                    <div class="question-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <button class="question-option" onclick="selectBudget('low')" data-value="low">
                            <span data-text="budget-low">< ‚Ç¨10k</span>
                            <small style="display: block; opacity: 0.7;" data-text="budget-low-desc">Budget serr√©</small>
                        </button>
                        <button class="question-option" onclick="selectBudget('medium')" data-value="medium">
                            <span data-text="budget-medium">‚Ç¨10k - ‚Ç¨50k</span>
                            <small style="display: block; opacity: 0.7;" data-text="budget-medium-desc">Budget mod√©r√©</small>
                        </button>
                        <button class="question-option" onclick="selectBudget('high')" data-value="high">
                            <span data-text="budget-high">‚Ç¨50k - ‚Ç¨200k</span>
                            <small style="display: block; opacity: 0.7;" data-text="budget-high-desc">Budget confortable</small>
                        </button>
                        <button class="question-option" onclick="selectBudget('unlimited')" data-value="unlimited">
                            <span data-text="budget-unlimited">> ‚Ç¨200k</span>
                            <small style="display: block; opacity: 0.7;" data-text="budget-unlimited-desc">Budget flexible</small>
                        </button>
                    </div>
                </div>

                <!-- √âtape 5: √âquipements -->
                <div class="questionnaire-step" id="step5" style="display: none;">
                    <h4 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="step5-title">5. De quels √©quipements disposez-vous ?</h4>
                    <div class="question-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="question-option multi-select" onclick="toggleEquipment(this, 'basic')" data-value="basic">
                            <span data-text="equipment-basic">√âquipement de base</span>
                            <small style="display: block; opacity: 0.7;" data-text="equipment-basic-desc">Centrifugeuse, incubateurs</small>
                        </button>
                        <button class="question-option multi-select" onclick="toggleEquipment(this, 'intermediate')" data-value="intermediate">
                            <span data-text="equipment-intermediate">FPLC/Chromatographie</span>
                            <small style="display: block; opacity: 0.7;" data-text="equipment-intermediate-desc">Purification avanc√©e</small>
                        </button>
                        <button class="question-option multi-select" onclick="toggleEquipment(this, 'bioreactor')" data-value="bioreactor">
                            <span data-text="equipment-bioreactor">Bior√©acteurs</span>
                            <small style="display: block; opacity: 0.7;" data-text="equipment-bioreactor-desc">Culture √† grande √©chelle</small>
                        </button>
                        <button class="question-option multi-select" onclick="toggleEquipment(this, 'analytical')" data-value="analytical">
                            <span data-text="equipment-analytical">Analytique avanc√©</span>
                            <small style="display: block; opacity: 0.7;" data-text="equipment-analytical-desc">LC-MS, HPLC, etc.</small>
                        </button>
                        <button class="question-option multi-select" onclick="toggleEquipment(this, 'none')" data-value="none">
                            <span data-text="equipment-none">Pas d'√©quipement</span>
                            <small style="display: block; opacity: 0.7;" data-text="equipment-none-desc">Externalisation requise</small>
                        </button>
                    </div>
                    <div style="margin-top: 2rem; text-align: center;">
                        <button class="action-btn" onclick="finishQuestionnaire()" data-text="finish-questionnaire">
                            Terminer le Questionnaire ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Indicateur de progression -->
            <div style="margin-top: 2rem;">
                <div style="background: rgba(74, 222, 128, 0.2); height: 4px; border-radius: 2px; overflow: hidden;">
                    <div id="questionnaireProgress" style="background: linear-gradient(90deg, #4ade80, #3b82f6); height: 100%; width: 20%; transition: width 0.3s;"></div>
                </div>
                <p style="color: #94a3b8; text-align: center; margin-top: 0.5rem; font-size: 0.9rem;">
                    <span data-text="progress-text">√âtape <span id="currentStep">1</span> sur 5</span>
                </p>
            </div>
        </div>

        <!-- S√©lection biomol√©cule -->
        <div class="molecule-selection" id="moleculeSelection">
            <h3 style="color: #f1f5f9; margin-bottom: 2rem; text-align: center;" data-text="molecule-title">üß¨ Type de Biomol√©cule</h3>
            <div class="molecule-grid">
                <div class="molecule-card" onclick="selectMolecule('protein')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üß™</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-protein">Prot√©ines Recombinantes</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-protein-desc">Enzymes, facteurs de croissance, cytokines</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('antibody')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üõ°Ô∏è</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-antibody">Anticorps Monoclonaux</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-antibody-desc">mAbs th√©rapeutiques, fragments</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('viral')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">ü¶†</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-viral">Vecteurs Viraux</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-viral-desc">AAV, lentivirus, th√©rapie g√©nique</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('vlp')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ö°</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-vlp">Virus-Like Particles</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-vlp-desc">VLP pour vaccins</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('lnp')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üíä</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-lnp">Lipid Nanoparticles</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-lnp-desc">LNP pour ARNm, siRNA</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('enzyme')">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚öôÔ∏è</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-enzyme">Enzymes Industrielles</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-enzyme-desc">Biocatalyse, applications</div>
                </div>
                <div class="molecule-card" onclick="selectMolecule('plasmid')" id="mol-plasmid">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üß≤</div>
                    <div style="font-weight: bold; color: #f1f5f9;" data-text="mol-plasmid">ADN Plasmidique</div>
                    <div style="color: #94a3b8; font-size: 0.85rem;" data-text="mol-plasmid-desc">Vecteurs d'expression, CRISPR</div>
                </div>
            </div>
        </div>

        <div class="protocol-generator" id="protocolGenerator">
            <h3 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="protocol-gen-title">ü§ñ G√©n√©rateur de Protocole IA</h3>
            
            <div class="input-group">
                <label class="input-label" data-text="production-goal">Objectif de Production</label>
                <input type="text" class="input-field" data-placeholder="production-goal-placeholder" placeholder="Ex: Production 10g anticorps anti-PD1 pour essais pr√©cliniques">
            </div>

            <div class="input-group">
                <label class="input-label" data-text="production-system">Syst√®me de Production</label>
                <select class="input-field" id="productionSystem">
                    <option data-text="system-ecoli">E. coli (BL21, Rosetta)</option>
                    <option data-text="system-cho">Cellules CHO (CHO-S, CHO-K1)</option>
                    <option data-text="system-yeast">Levure (Pichia pastoris)</option>
                    <option data-text="system-baculo">Baculovirus/Sf9</option>
                    <option data-text="system-plant">Expression plante</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label" data-text="purification-method">M√©thode de Purification</label>
                <select class="input-field" id="purificationMethod">
                    <option data-text="purif-chromato">Chromatographie multi-√©tapes (FPLC)</option>
                    <option data-text="purif-filtration">Filtration et ultrafiltration</option>
                    <option data-text="purif-precipitation">Pr√©cipitation s√©lective</option>
                    <option data-text="purif-extraction">Extraction liquide-liquide</option>
                    <option data-text="purif-crystallization">Cristallisation</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label" data-text="constraints">Contraintes Sp√©cifiques</label>
                <textarea class="input-field textarea-field" data-placeholder="constraints-placeholder" placeholder="Budget, timeline, √©quipement disponible, contraintes r√©glementaires GMP..."></textarea>
            </div>

            <button class="action-btn" onclick="generateProtocol()" style="width: 100%; margin-top: 1rem;" data-text="generate-protocol">
                üöÄ G√©n√©rer le Protocole
            </button>

            <div id="protocolOutput">
                <div class="generated-protocol" id="protocolContent"></div>
                <div style="margin-top: 1rem; display: none;" id="protocolActions">
                    <button class="action-btn" style="margin-right: 1rem;" onclick="saveProtocol()" data-text="save-protocol">üíæ Sauvegarder</button>
                    <button class="action-btn" onclick="exportPDF()" data-text="export-pdf">üìÑ T√©l√©charger PDF</button>
                </div>
            </div>
        </div>
    </section>

    <section class="recent-protocols">
        <h3 style="color: #f1f5f9; margin-bottom: 1.5rem;" data-text="recent-protocols">üìö Protocoles R√©cents</h3>
        
        <div class="protocol-item">
            <div class="protocol-meta">
                <span class="protocol-name">Production mAb anti-PD1 - Syst√®me CHO-S</span>
                <span class="protocol-date">28 Ao√ªt 2025</span>
            </div>
            <p style="color: #94a3b8;">Fed-batch 14 jours ‚Ä¢ Prot√©ine A + CEX + SEC ‚Ä¢ Rendement: 2.5 g/L</p>
        </div>

        <div class="protocol-item">
            <div class="protocol-meta">
                <span class="protocol-name">Vecteur AAV s√©rotype 9 - HEK293T</span>
                <span class="protocol-date">25 Ao√ªt 2025</span>
            </div>
            <p style="color: #94a3b8;">Triple transfection ‚Ä¢ Gradient iodixanol ‚Ä¢ Titre: 1√ó10¬π¬≥ vg/mL</p>
        </div>

        <div class="protocol-item">
            <div class="protocol-meta">
                <span class="protocol-name">Enzyme recombinante - E.coli optimis√©</span>
                <span class="protocol-date">22 Ao√ªt 2025</span>
            </div>
            <p style="color: #94a3b8;">BL21(DE3) ‚Ä¢ His-tag ‚Ä¢ Activit√©: 2500 U/mg ‚Ä¢ Stabilit√© 6 mois</p>
        </div>
    </section>
</div>

<script>
    // Variables globales avec questionnaire
    let currentState = {
        language: 'fr',
        documentOption: null,
        selectedMolecule: null,
        uploadedFiles: [],
        analyzedDocuments: [],
        // NOUVEAU: Donn√©es du questionnaire avec concentrations
        projectData: {
            type: null,
            concentration: null,  // MODIFI√â: quantit√© ‚Üí concentration
            timeline: null,
            budget: null,
            equipment: []
        },
        questionnaireStep: 1
    };

    // NOUVEAU: Traductions simples
    const texts = {
        fr: {
            'nav-home': 'Accueil',
            'nav-protocols': 'Protocoles',
            'nav-research': 'Recherche',
            'nav-training': 'Formation',
            'nav-contact': 'Contact',
            'hero-title': 'Protocoles Biotechnologiques',
            'hero-subtitle': 'Cr√©ez des protocoles de production et purification de biomol√©cules pharmaceutiques gr√¢ce √† l\'IA. Prot√©ines, anticorps, vecteurs viraux - optimis√©s pour votre recherche.',
            'start-now': 'Commencer Maintenant',
            'feature1-title': 'Analyse d\'Articles Scientifiques',
            'feature1-desc': 'Notre IA analyse automatiquement les derni√®res publications pour extraire les protocoles upstream/downstream et m√©thodologies pertinentes √† votre biomol√©cule.',
            'feature2-title': 'Production de Biomol√©cules',
            'feature2-desc': 'Protocoles sp√©cialis√©s pour prot√©ines recombinantes, anticorps, vecteurs viraux, VLP et LNP. De E.coli aux cellules mammaliennes.',
            'feature3-title': 'Upstream & Downstream',
            'feature3-desc': 'Workflow complet de la fermentation √† la formulation finale. Chromatographie, filtration, concentration - protocoles d√©taill√©s.',
            'explore': 'Explorer',
            'generate': 'G√©n√©rer',
            'browse': 'Parcourir',
            'stat1': 'Articles Biotech Analys√©s',
            'stat2': 'Protocoles G√©n√©r√©s',
            'stat3': 'Pharma Partenaires',
            'stat4': '% Satisfaction',
            'workspace-title': 'Espace de Cr√©ation',
            'new-project': 'Nouveau Projet',
            'doc-choice-title': 'üìö Documents de R√©f√©rence',
            'doc-choice-desc': 'Avez-vous des documents √† analyser ou souhaitez-vous une recherche automatique ?',
            'choice-upload': 'üìÑ J\'ai des Documents',
            'choice-upload-sub': 'Articles, protocoles existants',
            'choice-search': 'üîç Recherche Automatique',
            'choice-search-sub': 'L\'IA trouve les r√©f√©rences',
            'upload-title': 'Cliquez pour s√©lectionner vos fichiers PDF',
            'upload-subtitle': 'ou glissez-d√©posez ici',
            'upload-formats': 'Formats support√©s: PDF ‚Ä¢ Taille max: 10MB par fichier',
            'files-analyzed': 'üìÑ Fichiers Analys√©s:',
            'analysis-progress': 'ü§ñ Analyse en cours...',
            'analysis-init': 'Initialisation...',
            'molecule-title': 'üß¨ Type de Biomol√©cule',
            'mol-protein': 'Prot√©ines Recombinantes',
            'mol-protein-desc': 'Enzymes, facteurs de croissance, cytokines',
            'mol-antibody': 'Anticorps Monoclonaux',
            'mol-antibody-desc': 'mAbs th√©rapeutiques, fragments',
            'mol-viral': 'Vecteurs Viraux',
            'mol-viral-desc': 'AAV, lentivirus, th√©rapie g√©nique',
            'mol-vlp': 'Virus-Like Particles',
            'mol-vlp-desc': 'VLP pour vaccins',
            'mol-lnp': 'Lipid Nanoparticles',
            'mol-lnp-desc': 'LNP pour ARNm, siRNA',
            'mol-enzyme': 'Enzymes Industrielles',
            'mol-enzyme-desc': 'Biocatalyse, applications',
            'mol-plasmid': 'ADN Plasmidique',
            'mol-plasmid-desc': 'Vecteurs d\'expression, CRISPR',
            'protocol-gen-title': 'ü§ñ G√©n√©rateur de Protocole IA',
            'production-goal': 'Objectif de Production',
            'production-goal-placeholder': 'Ex: Production 10g anticorps anti-PD1 pour essais pr√©cliniques',
            'production-system': 'Syst√®me de Production',
            'system-ecoli': 'E. coli (BL21, Rosetta)',
            'system-cho': 'Cellules CHO (CHO-S, CHO-K1)',
            'system-yeast': 'Levure (Pichia pastoris)',
            'system-baculo': 'Baculovirus/Sf9',
            'system-plant': 'Expression plante',
            'purification-method': 'M√©thode de Purification',
            'purif-chromato': 'Chromatographie multi-√©tapes (FPLC)',
            'purif-filtration': 'Filtration et ultrafiltration',
            'purif-precipitation': 'Pr√©cipitation s√©lective',
            'purif-extraction': 'Extraction liquide-liquide',
            'purif-crystallization': 'Cristallisation',
            'constraints': 'Contraintes Sp√©cifiques',
            'constraints-placeholder': 'Budget, timeline, √©quipement disponible, contraintes r√©glementaires GMP...',
            'generate-protocol': 'üöÄ G√©n√©rer le Protocole',
            'save-protocol': 'üíæ Sauvegarder',
            'export-pdf': 'üìÑ T√©l√©charger PDF',
            'recent-protocols': 'üìö Protocoles R√©cents',
            // NOUVEAU: Traductions questionnaire
            'questionnaire-title': 'üéØ Questionnaire Projet',
            'questionnaire-desc': 'Quelques questions pour personnaliser votre protocole et optimiser les recommandations',
            'step1-title': '1. Quel est le type de votre projet ?',
            'project-research': 'Recherche Acad√©mique',
            'project-research-desc': 'Publications, √©tudes fondamentales',
            'project-preclinical': 'D√©veloppement Pr√©clinique',
            'project-preclinical-desc': 'Tests in vitro/in vivo',
            'project-clinical': 'D√©veloppement Clinique',
            'project-clinical-desc': 'Phases I/II/III',
            'project-commercial': 'Production Commerciale',
            'project-commercial-desc': 'Manufacturing, distribution',
            'step2-title': '2. Quelle concentration cible visez-vous ?',
            'concentration-low': 'Recherche',
            'concentration-low-desc': '0.1-10 mg/mL | 10^8-10^11 vp/mL',
            'concentration-medium': 'Production Pilote',
            'concentration-medium-desc': '1-50 mg/mL | 10^11-10^12 vp/mL',
            'concentration-high': 'Production Th√©rapeutique',
            'concentration-high-desc': '10-150 mg/mL | 10^12-10^13 vp/mL',
            'concentration-industrial': 'Production Industrielle',
            'concentration-industrial-desc': '> 100 mg/mL | > 10^13 vp/mL',
            'step3-title': '3. Dans quel d√©lai souhaitez-vous obtenir votre produit ?',
            'timeline-urgent': '< 2 semaines',
            'timeline-urgent-desc': 'Urgent',
            'timeline-normal': '2-8 semaines',
            'timeline-normal-desc': 'Standard',
            'timeline-flexible': '2-6 mois',
            'timeline-flexible-desc': 'Flexible',
            'timeline-long': '> 6 mois',
            'timeline-long-desc': 'Long terme',
            'step4-title': '4. Quel est votre budget approximatif ?',
            'budget-low': '< ‚Ç¨10k',
            'budget-low-desc': 'Budget serr√©',
            'budget-medium': '‚Ç¨10k - ‚Ç¨50k',
            'budget-medium-desc': 'Budget mod√©r√©',
            'budget-high': '‚Ç¨50k - ‚Ç¨200k',
            'budget-high-desc': 'Budget confortable',
            'budget-unlimited': '> ‚Ç¨200k',
            'budget-unlimited-desc': 'Budget flexible',
            'step5-title': '5. De quels √©quipements disposez-vous ?',
            'equipment-basic': '√âquipement de base',
            'equipment-basic-desc': 'Centrifugeuse, incubateurs',
            'equipment-intermediate': 'FPLC/Chromatographie',
            'equipment-intermediate-desc': 'Purification avanc√©e',
            'equipment-bioreactor': 'Bior√©acteurs',
            'equipment-bioreactor-desc': 'Culture √† grande √©chelle',
            'equipment-analytical': 'Analytique avanc√©',
            'equipment-analytical-desc': 'LC-MS, HPLC, etc.',
            'equipment-none': 'Pas d\'√©quipement',
            'equipment-none-desc': 'Externalisation requise',
            'finish-questionnaire': 'Terminer le Questionnaire ‚Üí',
            'progress-text': '√âtape <span id="currentStep">1</span> sur 5'
        },
        en: {
            'nav-home': 'Home',
            'nav-protocols': 'Protocols',
            'nav-research': 'Research',
            'nav-training': 'Training',
            'nav-contact': 'Contact',
            'hero-title': 'Biotechnology Protocols',
            'hero-subtitle': 'Create production and purification protocols for pharmaceutical biomolecules using AI. Proteins, antibodies, viral vectors - optimized for your research.',
            'start-now': 'Start Now',
            'feature1-title': 'Scientific Article Analysis',
            'feature1-desc': 'Our AI automatically analyzes the latest publications to extract upstream/downstream protocols and methodologies relevant to your biomolecule.',
            'feature2-title': 'Biomolecule Production',
            'feature2-desc': 'Specialized protocols for recombinant proteins, antibodies, viral vectors, VLPs and LNPs. From E.coli to mammalian cells.',
            'feature3-title': 'Upstream & Downstream',
            'feature3-desc': 'Complete workflow from fermentation to final formulation. Chromatography, filtration, concentration - detailed protocols.',
            'explore': 'Explore',
            'generate': 'Generate',
            'browse': 'Browse',
            'stat1': 'Biotech Articles Analyzed',
            'stat2': 'Protocols Generated',
            'stat3': 'Pharma Partners',
            'stat4': '% Satisfaction',
            'workspace-title': 'Creation Workspace',
            'new-project': 'New Project',
            'doc-choice-title': 'üìö Reference Documents',
            'doc-choice-desc': 'Do you have documents to analyze or would you like automatic search?',
            'choice-upload': 'üìÑ I Have Documents',
            'choice-upload-sub': 'Articles, existing protocols',
            'choice-search': 'üîç Automatic Search',
            'choice-search-sub': 'AI finds references',
            'upload-title': 'Click to select your PDF files',
            'upload-subtitle': 'or drag and drop here',
            'upload-formats': 'Supported formats: PDF ‚Ä¢ Max size: 10MB per file',
            'files-analyzed': 'üìÑ Files Analyzed:',
            'analysis-progress': 'ü§ñ Analysis in progress...',
            'analysis-init': 'Initialization...',
            'molecule-title': 'üß¨ Biomolecule Type',
            'mol-protein': 'Recombinant Proteins',
            'mol-protein-desc': 'Enzymes, growth factors, cytokines',
            'mol-antibody': 'Monoclonal Antibodies',
            'mol-antibody-desc': 'Therapeutic mAbs, fragments',
            'mol-viral': 'Viral Vectors',
            'mol-viral-desc': 'AAV, lentivirus, gene therapy',
            'mol-vlp': 'Virus-Like Particles',
            'mol-vlp-desc': 'VLPs for vaccines',
            'mol-lnp': 'Lipid Nanoparticles',
            'mol-lnp-desc': 'LNPs for mRNA, siRNA',
            'mol-enzyme': 'Industrial Enzymes',
            'mol-enzyme-desc': 'Biocatalysis, applications',
            'mol-plasmid': 'Plasmid DNA',
            'mol-plasmid-desc': 'Expression vectors, CRISPR',
            'protocol-gen-title': 'ü§ñ AI Protocol Generator',
            'production-goal': 'Production Goal',
            'production-goal-placeholder': 'Ex: Produce 10g anti-PD1 antibody for preclinical trials',
            'production-system': 'Production System',
            'system-ecoli': 'E. coli (BL21, Rosetta)',
            'system-cho': 'CHO Cells (CHO-S, CHO-K1)',
            'system-yeast': 'Yeast (Pichia pastoris)',
            'system-baculo': 'Baculovirus/Sf9',
            'system-plant': 'Plant expression',
            'purification-method': 'Purification Method',
            'purif-chromato': 'Multi-step chromatography (FPLC)',
            'purif-filtration': 'Filtration and ultrafiltration',
            'purif-precipitation': 'Selective precipitation',
            'purif-extraction': 'Liquid-liquid extraction',
            'purif-crystallization': 'Crystallization',
            'constraints': 'Specific Constraints',
            'constraints-placeholder': 'Budget, timeline, available equipment, GMP regulatory constraints...',
            'generate-protocol': 'üöÄ Generate Protocol',
            'save-protocol': 'üíæ Save',
            'export-pdf': 'üìÑ Download PDF',
            'recent-protocols': 'üìö Recent Protocols',
            // NOUVEAU: Traductions questionnaire anglais
            'questionnaire-title': 'üéØ Project Questionnaire',
            'questionnaire-desc': 'A few questions to personalize your protocol and optimize recommendations',
            'step1-title': '1. What type of project is this?',
            'project-research': 'Academic Research',
            'project-research-desc': 'Publications, fundamental studies',
            'project-preclinical': 'Preclinical Development',
            'project-preclinical-desc': 'In vitro/in vivo testing',
            'project-clinical': 'Clinical Development',
            'project-clinical-desc': 'Phase I/II/III',
            'project-commercial': 'Commercial Production',
            'project-commercial-desc': 'Manufacturing, distribution',
            'step2-title': '2. What is your target concentration?',
            'concentration-low': 'Research',
            'concentration-low-desc': '0.1-10 mg/mL | 10^8-10^11 vp/mL',
            'concentration-medium': 'Pilot Production',
            'concentration-medium-desc': '1-50 mg/mL | 10^11-10^12 vp/mL',
            'concentration-high': 'Therapeutic Production',
            'concentration-high-desc': '10-150 mg/mL | 10^12-10^13 vp/mL',
            'concentration-industrial': 'Industrial Production',
            'concentration-industrial-desc': '> 100 mg/mL | > 10^13 vp/mL',
            'step3-title': '3. What is your desired timeline?',
            'timeline-urgent': '< 2 weeks',
            'timeline-urgent-desc': 'Urgent',
            'timeline-normal': '2-8 weeks',
            'timeline-normal-desc': 'Standard',
            'timeline-flexible': '2-6 months',
            'timeline-flexible-desc': 'Flexible',
            'timeline-long': '> 6 months',
            'timeline-long-desc': 'Long term',
            'step4-title': '4. What is your approximate budget?',
            'budget-low': '< ‚Ç¨10k',
            'budget-low-desc': 'Tight budget',
            'budget-medium': '‚Ç¨10k - ‚Ç¨50k',
            'budget-medium-desc': 'Moderate budget',
            'budget-high': '‚Ç¨50k - ‚Ç¨200k',
            'budget-high-desc': 'Comfortable budget',
            'budget-unlimited': '> ‚Ç¨200k',
            'budget-unlimited-desc': 'Flexible budget',
            'step5-title': '5. What equipment do you have access to?',
            'equipment-basic': 'Basic Equipment',
            'equipment-basic-desc': 'Centrifuge, incubators',
            'equipment-intermediate': 'FPLC/Chromatography',
            'equipment-intermediate-desc': 'Advanced purification',
            'equipment-bioreactor': 'Bioreactors',
            'equipment-bioreactor-desc': 'Large-scale culture',
            'equipment-analytical': 'Advanced Analytics',
            'equipment-analytical-desc': 'LC-MS, HPLC, etc.',
            'equipment-none': 'No Equipment',
            'equipment-none-desc': 'Outsourcing required',
            'finish-questionnaire': 'Finish Questionnaire ‚Üí',
            'progress-text': 'Step <span id="currentStep">1</span> of 5'
        }
    };

    // NOUVEAU: Fonction de changement de langue
    function switchLanguage(lang) {
        currentState.language = lang;
        
        // Mettre √† jour les boutons de langue
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Mettre √† jour tous les textes
        updateTexts();
    }

    // NOUVEAU: Fonction de mise √† jour des textes
    function updateTexts() {
        const lang = currentState.language;
        
        // Mettre √† jour les √©l√©ments avec data-text
        document.querySelectorAll('[data-text]').forEach(element => {
            const key = element.getAttribute('data-text');
            if (texts[lang] && texts[lang][key]) {
                element.textContent = texts[lang][key];
            }
        });
        
        // Mettre √† jour les placeholders
        document.querySelectorAll('[data-placeholder]').forEach(element => {
            const key = element.getAttribute('data-placeholder');
            if (texts[lang] && texts[lang][key]) {
                element.placeholder = texts[lang][key];
            }
        });
    }

    // Configuration PDF.js
    if (typeof pdfjsLib !== 'undefined') {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }

    // Cr√©er des particules flottantes
    function createParticles() {
        const particlesContainer = document.getElementById('particles');
        const particleCount = 50;

        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.top = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 6 + 's';
            particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
            particlesContainer.appendChild(particle);
        }
    }

    // Navigation
    function scrollToWorkspace() {
        document.getElementById('workspace').scrollIntoView({ 
            behavior: 'smooth' 
        });
    }

    // Workflow
    function selectDocumentOption(option) {
        currentState.documentOption = option;
        
        // Mise √† jour visuelle
        document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
        event.target.classList.add('selected');
        
        if (option === 'upload') {
            document.getElementById('uploadZone').style.display = 'block';
            setTimeout(() => {
                document.getElementById('uploadZone').scrollIntoView({ behavior: 'smooth' });
            }, 300);
        } else {
            // MODIFI√â: Aller au questionnaire au lieu de directement aux mol√©cules
            setTimeout(() => {
                document.getElementById('projectQuestionnaire').style.display = 'block';
                document.getElementById('projectQuestionnaire').scrollIntoView({ behavior: 'smooth' });
            }, 1000);
        }
    }

    // NOUVEAU: Fonctions du questionnaire
    function selectProjectType(type) {
        currentState.projectData.type = type;
        selectOption('step1', type);
        nextStep();
    }

    function selectConcentration(concentration) {
        currentState.projectData.concentration = concentration;
        selectOption('step2', concentration);
        nextStep();
    }

    function selectTimeline(timeline) {
        currentState.projectData.timeline = timeline;
        selectOption('step3', timeline);
        nextStep();
    }

    function selectBudget(budget) {
        currentState.projectData.budget = budget;
        selectOption('step4', budget);
        nextStep();
    }

    function toggleEquipment(element, equipment) {
        if (equipment === 'none') {
            // Si "Pas d'√©quipement" est s√©lectionn√©, d√©s√©lectionner tout le reste
            currentState.projectData.equipment = ['none'];
            document.querySelectorAll('#step5 .question-option').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
        } else {
            // Retirer "none" si autre √©quipement s√©lectionn√©
            currentState.projectData.equipment = currentState.projectData.equipment.filter(eq => eq !== 'none');
            
            if (currentState.projectData.equipment.includes(equipment)) {
                // D√©s√©lectionner
                currentState.projectData.equipment = currentState.projectData.equipment.filter(eq => eq !== equipment);
                element.classList.remove('selected');
            } else {
                // S√©lectionner
                currentState.projectData.equipment.push(equipment);
                element.classList.add('selected');
                
                // Retirer "none" des s√©lections visuelles
                document.querySelector('#step5 .question-option[data-value="none"]').classList.remove('selected');
            }
        }
    }

    function selectOption(stepId, value) {
        // D√©s√©lectionner toutes les options de cette √©tape
        document.querySelectorAll(`#${stepId} .question-option`).forEach(btn => {
            btn.classList.remove('selected');
        });
        
        // S√©lectionner l'option choisie
        document.querySelector(`#${stepId} .question-option[data-value="${value}"]`).classList.add('selected');
    }

    function nextStep() {
        if (currentState.questionnaireStep < 5) {
            // Cacher l'√©tape actuelle
            document.getElementById(`step${currentState.questionnaireStep}`).style.display = 'none';
            
            // Passer √† l'√©tape suivante
            currentState.questionnaireStep++;
            document.getElementById(`step${currentState.questionnaireStep}`).style.display = 'block';
            
            // Mettre √† jour la progression
            updateProgress();
        }
    }

    function updateProgress() {
        const progress = (currentState.questionnaireStep / 5) * 100;
        document.getElementById('questionnaireProgress').style.width = `${progress}%`;
        document.getElementById('currentStep').textContent = currentState.questionnaireStep;
    }

    function finishQuestionnaire() {
        // Analyser les r√©ponses et g√©n√©rer des recommandations
        analyzeProjectData();
        
        // Cacher le questionnaire et montrer la s√©lection de mol√©cules
        document.getElementById('projectQuestionnaire').style.display = 'none';
        document.getElementById('moleculeSelection').style.display = 'block';
        document.getElementById('moleculeSelection').scrollIntoView({ behavior: 'smooth' });
        
        // Message de confirmation avec insights
        const insights = generateProjectInsights();
        const message = currentState.language === 'fr' ? 
            `‚úÖ Questionnaire termin√© !\n\nüí° Insights de votre projet :\n${insights}` :
            `‚úÖ Questionnaire completed!\n\nüí° Project insights:\n${insights}`;
        alert(message);
    }

    function analyzeProjectData() {
        const data = currentState.projectData;
        
        // Calculer le score de complexit√©
        let complexityScore = 0;
        
        if (data.type === 'commercial') complexityScore += 3;
        else if (data.type === 'clinical') complexityScore += 2;
        else if (data.type === 'preclinical') complexityScore += 1;
        
        if (data.concentration === 'industrial') complexityScore += 3;
        else if (data.concentration === 'high') complexityScore += 2;
        else if (data.concentration === 'medium') complexityScore += 1;
        
        if (data.timeline === 'urgent') complexityScore += 2;
        else if (data.timeline === 'normal') complexityScore += 1;
        
        if (data.budget === 'low') complexityScore += 2;
        
        if (data.equipment.includes('none')) complexityScore += 2;
        
        currentState.projectData.complexityScore = complexityScore;
        currentState.projectData.complexity = complexityScore >= 6 ? 'high' : complexityScore >= 3 ? 'medium' : 'low';
    }

    function generateProjectInsights() {
        const data = currentState.projectData;
        const lang = currentState.language;
        
        let insights = [];
        
        // Insights bas√©s sur le type de projet
        if (data.type === 'research') {
            insights.push(lang === 'fr' ? '‚Ä¢ Focus sur la preuve de concept et la reproductibilit√©' : '‚Ä¢ Focus on proof of concept and reproducibility');
        } else if (data.type === 'commercial') {
            insights.push(lang === 'fr' ? '‚Ä¢ Contraintes GMP et scalabilit√© critiques' : '‚Ä¢ GMP constraints and scalability critical');
        }
        
        // Insights bas√©s sur la concentration
        if (data.concentration === 'low') {
            insights.push(lang === 'fr' ? '‚Ä¢ Protocoles laboratoire optimis√©s' : '‚Ä¢ Laboratory-optimized protocols');
        } else if (data.concentration === 'industrial') {
            insights.push(lang === 'fr' ? '‚Ä¢ N√©cessit√© d\'√©quipements industriels' : '‚Ä¢ Industrial equipment required');
        }
        
        // Insights bas√©s sur le d√©lai
        if (data.timeline === 'urgent') {
            insights.push(lang === 'fr' ? '‚Ä¢ Protocoles rapides et pr√™ts-√†-utiliser' : '‚Ä¢ Fast, ready-to-use protocols');
        }
        
        // Insights bas√©s sur l'√©quipement
        if (data.equipment.includes('none')) {
            insights.push(lang === 'fr' ? '‚Ä¢ Recommandations de prestataires externes' : '‚Ä¢ External service provider recommendations');
        }
        
        return insights.slice(0, 3).join('\n');
    }

    function selectMolecule(moleculeType) {
        currentState.selectedMolecule = moleculeType;
        
        // Mise √† jour visuelle
        document.querySelectorAll('.molecule-card').forEach(card => card.classList.remove('selected'));
        event.target.classList.add('selected');
        
        const moleculeNames = {
            'protein': currentState.language === 'fr' ? 'Prot√©ines Recombinantes' : 'Recombinant Proteins',
            'antibody': currentState.language === 'fr' ? 'Anticorps Monoclonaux' : 'Monoclonal Antibodies', 
            'viral': currentState.language === 'fr' ? 'Vecteurs Viraux' : 'Viral Vectors',
            'vlp': 'Virus-Like Particles',
            'lnp': 'Lipid Nanoparticles',
            'enzyme': currentState.language === 'fr' ? 'Enzymes Industrielles' : 'Industrial Enzymes',
            'plasmid': currentState.language === 'fr' ? 'ADN Plasmidique' : 'Plasmid DNA'
        };
        
        setTimeout(() => {
            document.getElementById('protocolGenerator').style.display = 'block';
            document.getElementById('protocolGenerator').scrollIntoView({ behavior: 'smooth' });
            
            // Message dans la langue appropri√©e
            const message = currentState.language === 'fr' ? 
                `‚úÖ ${moleculeNames[moleculeType]} s√©lectionn√© ! Vous pouvez maintenant g√©n√©rer votre protocole.` :
                `‚úÖ ${moleculeNames[moleculeType]} selected! You can now generate your protocol.`;
            alert(message);
        }, 500);
    }

    // Gestion des fichiers (conserv√©e de l'original)
    const uploadZone = document.getElementById('uploadZone');
    
    uploadZone.addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    uploadZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = '#4ade80';
        this.style.background = 'rgba(74, 222, 128, 0.1)';
    });

    uploadZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.style.borderColor = 'rgba(74, 222, 128, 0.3)';
        this.style.background = 'rgba(30, 41, 59, 0.4)';
    });

    uploadZone.addEventListener('drop', function(e) {
        e.preventDefault();
        this.style.borderColor = 'rgba(74, 222, 128, 0.3)';
        this.style.background = 'rgba(30, 41, 59, 0.4)';
        
        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) {
            handleRealFileUpload({ target: { files: files } });
        }
    });

    async function handleRealFileUpload(event) {
        const files = Array.from(event.target.files);
        
        if (files.length === 0) return;
        
        const validFiles = files.filter(file => {
            if (file.type !== 'application/pdf') {
                const message = currentState.language === 'fr' ? 
                    `‚ùå ${file.name}: Seuls les PDF sont support√©s` :
                    `‚ùå ${file.name}: Only PDFs are supported`;
                alert(message);
                return false;
            }
            if (file.size > 10 * 1024 * 1024) {
                const message = currentState.language === 'fr' ? 
                    `‚ùå ${file.name}: Fichier trop volumineux (max 10MB)` :
                    `‚ùå ${file.name}: File too large (max 10MB)`;
                alert(message);
                return false;
            }
            return true;
        });

        if (validFiles.length === 0) return;

        currentState.uploadedFiles = validFiles;
        displayUploadedFiles(validFiles);
        await analyzeUploadedFiles(validFiles);
    }

    function displayUploadedFiles(files) {
        const filesList = document.getElementById('filesList');
        const container = document.getElementById('uploadedFilesList');
        
        const readyText = currentState.language === 'fr' ? 'Pr√™t' : 'Ready';
        
        filesList.innerHTML = '';
        files.forEach(file => {
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'background: rgba(45, 55, 72, 0.7); border: 1px solid rgba(74, 222, 128, 0.2); border-radius: 8px; padding: 1rem; margin: 0.5rem 0; display: flex; align-items: center; gap: 1rem;';
            fileItem.innerHTML = `
                <div style="font-size: 1.5rem;">üìÑ</div>
                <div style="flex-grow: 1;">
                    <div style="color: #f1f5f9; font-weight: bold;">${file.name}</div>
                    <div style="color: #94a3b8; font-size: 0.9rem;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
                </div>
                <div style="color: #4ade80;">‚úÖ ${readyText}</div>
            `;
            filesList.appendChild(fileItem);
        });
        
        container.style.display = 'block';
    }

    async function analyzeUploadedFiles(files) {
        const progressDiv = document.getElementById('analysisProgress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        progressDiv.style.display = 'block';
        currentState.analyzedDocuments = [];
        
        try {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const progress = ((i + 1) / files.length) * 100;
                
                progressBar.style.width = `${progress}%`;
                const analyzing = currentState.language === 'fr' ? 
                    `Analyse de ${file.name}... (${i + 1}/${files.length})` :
                    `Analyzing ${file.name}... (${i + 1}/${files.length})`;
                progressText.innerHTML = analyzing;
                
                const extractedText = await extractTextFromPDF(file);
                const analysis = analyzeDocumentContent(extractedText, file.name);
                
                currentState.analyzedDocuments.push({
                    filename: file.name,
                    text: extractedText.substring(0, 5000),
                    analysis: analysis,
                    wordCount: extractedText.split(' ').length
                });
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const completed = currentState.language === 'fr' ? 
                `‚úÖ Analyse termin√©e! ${files.length} document(s) trait√©(s)` :
                `‚úÖ Analysis completed! ${files.length} document(s) processed`;
            progressText.innerHTML = completed;
            
            setTimeout(() => {
                progressDiv.style.display = 'none';
                // MODIFI√â: Aller au questionnaire apr√®s l'upload
                document.getElementById('projectQuestionnaire').style.display = 'block';
                document.getElementById('projectQuestionnaire').scrollIntoView({ behavior: 'smooth' });
                
                const statsMessage = currentState.language === 'fr' ? 
                    `üéâ Analyse termin√©e!\n\nüìä Statistiques:\n‚Ä¢ ${files.length} fichier(s) analys√©s\n‚Ä¢ ${currentState.analyzedDocuments.reduce((acc, doc) => acc + doc.wordCount, 0)} mots extraits\n‚Ä¢ Protocoles d√©tect√©s dans ${currentState.analyzedDocuments.length} documents` :
                    `üéâ Analysis completed!\n\nüìä Statistics:\n‚Ä¢ ${files.length} file(s) analyzed\n‚Ä¢ ${currentState.analyzedDocuments.reduce((acc, doc) => acc + doc.wordCount, 0)} words extracted\n‚Ä¢ Protocols detected in ${currentState.analyzedDocuments.length} documents`;
                alert(statsMessage);
            }, 1000);
            
        } catch (error) {
            console.error('Erreur analyse:', error);
            const errorMsg = currentState.language === 'fr' ? 
                `‚ùå Erreur d'analyse: ${error.message}` :
                `‚ùå Analysis error: ${error.message}`;
            progressText.innerHTML = errorMsg;
            alert(errorMsg);
        }
    }

    async function extractTextFromPDF(file) {
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = '';
            
            for (let pageNum = 1; pageNum <= Math.min(pdf.numPages, 10); pageNum++) {
                const page = await pdf.getPage(pageNum);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + '\n\n';
            }
            
            return fullText.trim();
            
        } catch (error) {
            console.error('Erreur extraction PDF:', error);
            return `Erreur extraction PDF ${file.name}: ${error.message}`;
        }
    }

    function analyzeDocumentContent(text, filename) {
        const analysis = {
            protocols: [],
            methodologies: [],
            keywords: [],
            molecules: [],
            summary: ''
        };
        
        const protocolPatterns = [
            /protocol[s]?\s*[:.]?\s*([^.\n]{20,100})/gi,
            /method[s]?\s*[:.]?\s*([^.\n]{20,100})/gi,
            /procedure[s]?\s*[:.]?\s*([^.\n]{20,100})/gi
        ];
        
        protocolPatterns.forEach(pattern => {
            const matches = [...text.matchAll(pattern)];
            matches.forEach(match => {
                if (match[1]) analysis.protocols.push(match[1].trim());
            });
        });
        
        const moleculeKeywords = ['protein', 'antibody', 'enzyme', 'vector', 'plasmid', 'cell line', 'expression', 'purification', 'chromatography'];
        moleculeKeywords.forEach(keyword => {
            if (text.toLowerCase().includes(keyword)) {
                analysis.molecules.push(keyword);
            }
        });
        
        const methodKeywords = ['ELISA', 'Western blot', 'PCR', 'transfection', 'fermentation', 'FPLC', 'HPLC', 'spectroscopy'];
        methodKeywords.forEach(method => {
            if (text.toLowerCase().includes(method.toLowerCase())) {
                analysis.methodologies.push(method);
            }
        });
        
        analysis.summary = `Document analys√©: ${filename}. ${analysis.protocols.length} protocoles d√©tect√©s, ${analysis.methodologies.length} m√©thodologies identifi√©es.`;
        
        return analysis;
    }

    // G√©n√©rateur de protocole
    function generateProtocol() {
        const protocolContent = document.getElementById('protocolContent');
        const protocolActions = document.getElementById('protocolActions');
        
        if (!currentState.selectedMolecule) {
            const message = currentState.language === 'fr' ? 
                '‚ö†Ô∏è Veuillez d\'abord s√©lectionner un type de biomol√©cule' :
                '‚ö†Ô∏è Please first select a biomolecule type';
            alert(message);
            return;
        }
        
        protocolContent.style.display = 'block';
        const generating = currentState.language === 'fr' ? 'G√©n√©ration en cours...' : 'Generating...';
        protocolContent.innerHTML = generating;
        
        setTimeout(() => {
            const protocol = createDetailedProtocol(currentState.selectedMolecule);
            protocolContent.innerHTML = protocol;
            protocolActions.style.display = 'block';
            
            document.getElementById('protocolOutput').scrollIntoView({ behavior: 'smooth' });
        }, 2000);
    }

    function createDetailedProtocol(molecule) {
        const protocols = {
            'protein': generateProteinProtocol(),
            'antibody': generateAntibodyProtocol(),
            'viral': generateViralProtocol()
        };

        return protocols[molecule] || protocols['protein'];
    }

    function generateProteinProtocol() {
        const lang = currentState.language;
        let documentInsights = '';
        
        if (currentState.analyzedDocuments.length > 0) {
            documentInsights = lang === 'fr' ? `
                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #3b82f6;">
                    <strong style="color: #3b82f6;">üìÑ INSIGHTS DES DOCUMENTS ANALYS√âS</strong><br>
                    ‚Ä¢ ${currentState.analyzedDocuments.length} document(s) analys√©(s)<br>
                    ‚Ä¢ ${currentState.analyzedDocuments.reduce((acc, doc) => acc + doc.analysis.protocols.length, 0)} protocole(s) extrait(s)<br>
                    ‚Ä¢ M√©thodologies d√©tect√©es: ${[...new Set(currentState.analyzedDocuments.flatMap(doc => doc.analysis.methodologies))].join(', ')}<br>
                    ‚Ä¢ Mots-cl√©s identifi√©s: ${[...new Set(currentState.analyzedDocuments.flatMap(doc => doc.analysis.molecules))].join(', ')}
                </div>
            ` : `
                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #3b82f6;">
                    <strong style="color: #3b82f6;">üìÑ ANALYZED DOCUMENTS INSIGHTS</strong><br>
                    ‚Ä¢ ${currentState.analyzedDocuments.length} document(s) analyzed<br>
                    ‚Ä¢ ${currentState.analyzedDocuments.reduce((acc, doc) => acc + doc.analysis.protocols.length, 0)} protocol(s) extracted<br>
                    ‚Ä¢ Detected methodologies: ${[...new Set(currentState.analyzedDocuments.flatMap(doc => doc.analysis.methodologies))].join(', ')}<br>
                    ‚Ä¢ Identified keywords: ${[...new Set(currentState.analyzedDocuments.flatMap(doc => doc.analysis.molecules))].join(', ')}
                </div>
            `;
        }
        
        const title = lang === 'fr' ? 'PROTOCOLE DE PRODUCTION - PROT√âINE RECOMBINANTE' : 'PRODUCTION PROTOCOL - RECOMBINANT PROTEIN';
        
        return `
            <h4 style="color: #4ade80; margin-bottom: 1rem;">üìä ${title}</h4>
            
            ${documentInsights}
            
            <strong style="color: #f1f5f9;">${lang === 'fr' ? '1. UPSTREAM PROCESSING' : '1. UPSTREAM PROCESSING'}</strong><br>
            ‚Ä¢ Expression E. coli BL21(DE3) + plasmide pET<br>
            ‚Ä¢ Milieu: LB ou M9 d√©fini + antibiotique s√©lection<br>
            ‚Ä¢ Culture: 37¬∞C jusqu'√† DO‚ÇÜ‚ÇÄ‚ÇÄ = 0.6-0.8<br>
            ‚Ä¢ Induction: IPTG 0.1-1 mM, r√©duction temp√©rature 25¬∞C<br>
            ‚Ä¢ Expression: 4-16h selon optimisation<br>
            ‚Ä¢ R√©colte: Centrifugation 4000g, 20 min, 4¬∞C<br><br>
            
            <strong style="color: #f1f5f9;">${lang === 'fr' ? '2. DOWNSTREAM PROCESSING' : '2. DOWNSTREAM PROCESSING'}</strong><br>
            ‚Ä¢ Lyse cellulaire: Sonication ou French Press + inhibiteurs prot√©ases<br>
            ‚Ä¢ Clarification: Centrifugation 15000g, 30 min, 4¬∞C<br>
            ‚Ä¢ Purification His-tag: Colonne Ni-NTA<br>
            ‚Ä¢ Lavage: Imidazole 20mM<br>
            ‚Ä¢ √âlution: Gradient imidazole 20-500mM<br>
            ‚Ä¢ Polissage: Chromatographie exclusion taille<br>
            ‚Ä¢ Concentration: Colonnes Amicon 10K MWCO<br><br>
            
            <strong style="color: #4ade80;">${lang === 'fr' ? 'Rendement attendu:' : 'Expected yield:'}</strong> 50-500 mg/L culture<br>
            <strong style="color: #4ade80;">Timeline:</strong> 7-10 ${lang === 'fr' ? 'jours' : 'days'}
        `;
    }

    function generateAntibodyProtocol() {
        return generateProteinProtocol(); // Simplifi√© pour l'exemple
    }

    function generateViralProtocol() {
        return generateProteinProtocol(); // Simplifi√© pour l'exemple
    }

    // Actions
    function saveProtocol() {
        const message = currentState.language === 'fr' ? 
            'üíæ Protocole sauvegard√© dans votre biblioth√®que!' :
            'üíæ Protocol saved to your library!';
        alert(message);
    }

    function exportPDF() {
        const protocolContent = document.getElementById('protocolContent');
        if (!protocolContent.innerHTML || protocolContent.innerHTML.includes('cours...')) {
            const message = currentState.language === 'fr' ? 
                '‚ö†Ô∏è Veuillez d\'abord g√©n√©rer un protocole' :
                '‚ö†Ô∏è Please generate a protocol first';
            alert(message);
            return;
        }

        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            let yPosition = margin;

            doc.setFontSize(20);
            doc.setTextColor(74, 222, 128);
            doc.text('MONTES BIO', margin, yPosition);
            
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            yPosition += 10;
            const protocolTitle = currentState.language === 'fr' ? 
                'Protocole Biotechnologique' : 'Biotechnology Protocol';
            doc.text(protocolTitle, margin, yPosition);
            
            yPosition += 10;
            doc.setDrawColor(74, 222, 128);
            doc.line(margin, yPosition, pageWidth - margin, yPosition);
            yPosition += 15;

            doc.setFontSize(12);
            const dateText = currentState.language === 'fr' ? 
                'Date de g√©n√©ration: ' : 'Generation date: ';
            doc.text(dateText + new Date().toLocaleDateString(), margin, yPosition);
            yPosition += 15;

            // Contenu du protocole
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = protocolContent.innerHTML;
            const textContent = tempDiv.textContent || tempDiv.innerText || '';
            
            const lines = textContent.split('\n').filter(line => line.trim() !== '');
            
            doc.setFontSize(10);
            lines.forEach(line => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = margin;
                }
                
                const wrappedLines = doc.splitTextToSize(line.trim(), pageWidth - 40);
                wrappedLines.forEach(wrappedLine => {
                    doc.text(wrappedLine, margin, yPosition);
                    yPosition += 5;
                });
                yPosition += 2;
            });

            const fileName = 'Protocole_MontesBio_' + new Date().toISOString().slice(0,10) + '.pdf';
            doc.save(fileName);
            
            const confirmMessage = currentState.language === 'fr' ? 
                '‚úÖ PDF g√©n√©r√© et t√©l√©charg√©: ' + fileName :
                '‚úÖ PDF generated and downloaded: ' + fileName;
            alert(confirmMessage);
            
        } catch (error) {
            console.error('Erreur g√©n√©ration PDF:', error);
            const errorMessage = currentState.language === 'fr' ? 
                '‚ùå Erreur lors de la g√©n√©ration PDF. V√©rifiez la console.' :
                '‚ùå Error generating PDF. Check console.';
            alert(errorMessage);
        }
    }

    // Initialisation
    window.addEventListener('load', function() {
        createParticles();
        
        if (typeof pdfjsLib !== 'undefined') {
            console.log('‚úÖ PDF.js charg√© et pr√™t');
        } else {
            console.warn('‚ö†Ô∏è PDF.js non disponible - fonctionnalit√© upload limit√©e');
        }
        
        console.log('üß¨ Montes Bio - Version Multilingue Initialis√©e');
    });
</script>
```

</body>
</html>
